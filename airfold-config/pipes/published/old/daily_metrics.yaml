name: daily_metrics
nodes:
  - node1:
      sql: |
        SELECT
          sum(no_of_sessions) AS no_of_sessions,
          sum(no_of_users) AS total_users,
          sum(no_of_new_users) AS total_new_users,
          sum(no_of_users)-sum(no_of_new_users) AS no_of_returning_users,
          avg(total_time_spent) AS avg_time_spent,
          sum(pageviews) AS page_views,
          round(sum(conversions)/sum(pageviews), 3) AS conversion_rate
        FROM daily_traffic_metrics
        WHERE event_date = {{inp_date}}
        GROUP BY event_date
        ORDER BY event_date
publish: daily_metrics
params:
  - name: inp_date
    type: string
    default: "2023-01-01"
