name: mv_campaign_performance
nodes:
  - agg:
      sql: |
        SELECT
          campaign,
          count() AS total_sessions,
          countIf(conversion_flag = 1) AS total_conversions,
          countDistinct(user_id) AS unique_users
        FROM web_events
        WHERE campaign IS NOT NULL
        GROUP BY campaign
to: campaign_metrics
refresh:
  strategy: replace
  interval: EVERY 1 MONTH
