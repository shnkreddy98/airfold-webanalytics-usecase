name: daily_city_summary
nodes:
  - summary:
      sql: |
        SELECT
          city,
          sum(no_of_users) AS no_of_users,
          sum(pageviews) AS total_views,
          sum(conversions) AS total_conversions,
          round(sum(conversions)/sum(pageviews), 3) AS conversion_rate
        FROM daily_traffic_metrics
        WHERE event_date={{inp_date}}
        GROUP BY city
publish: daily_city_summary
params:
  - name: inp_date
    type: string
    default: "2023-01-01"
